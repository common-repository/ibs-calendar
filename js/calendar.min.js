function ibs_util_19(){return"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc"}function IsEmail(c){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(c)}function CalendarObj(c,f,h){this.init(f,h)}
(function(c){CalendarObj.prototype.init=function(f,h){var d=this;this.args=f;this.mode=h;this.id=f.id;this.calendar=c("#fullcalendar-"+this.id);this.options={id:"1",feeds:{},ajaxUrl:null,ajaxData:null};for(var k in f)"undefined"!==typeof this.options[k]&&(this.options[k]=f[k]);this.qtip_params=function(b){var a=d.fullcalendar_options.timeFormat,c=f.qtip.title.replace("%title%",b.title),e="";"undefined"!==typeof b.location&&""!==b.location&&(e=f.qtip.location.replace("%location%",b.location));var u=
"";!1===b.source.nodesc&&"undefined"!==typeof b.description&&""!==b.description&&(u=f.qtip.description.replace("%description%",b.description));var r="",r=moment(b.start).format("ddd MMM DD "+a)+moment(b.end).format(" - "+a);b.allDay&&(r=moment(b.start).format("ddd MMM DD")+"  All day");r=f.qtip.time.replace("%time%",r);return{content:{text:f.qtip.order.replace("%title%",c).replace("%location%",e).replace("%description%",u).replace("%time%",r)},position:{my:"bottom center",at:"top center"},style:{classes:f.qtip.style+
" "+f.qtip.rounded+f.qtip.shadow},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}}};this.fullcalendar_options={timezone:"local",height:null,theme:!0,firstDay:"1",weekends:!0,lang:"en_us",timeFormat:"hh:mm a",titleFormat:"YYYY MMM DD",dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),defaultView:"month",eventLimit:6,eventLimitClick:"popover",aspectRatio:1,editable:!1,hiddenDays:"",fixedWeekCount:!0,weekNumbers:!1,defaultDate:moment()};for(k in f)"undefined"!==typeof this.fullcalendar_options[k]&&
""!==f[k]&&(this.fullcalendar_options[k]=f[k]);this.fullcalendar_options.header={left:f.headerLeft,center:f.headerCenter,right:f.headerRight};this.fullcalendar_options.loading=function(b){if(b&&"widget"!==h){b=c("#fullcalendar-"+d.options.id).position();var a=c("#fullcalendar-"+d.options.id).width(),f=c("#fullcalendar-"+d.options.id).height();c("#ibs-loading-"+d.options.id).css({left:b.left,top:b.top,width:a,height:f}).show()}else c("#ibs-loading-"+d.options.id).hide()};this.fullcalendar_options.eventRender=
function(b,a,c){("widget"===h||f.hideTitle)&&a.css("color",a.css("background-color"));a.css("cursor","pointer");"admin"===h&&"month"!==c.name||a.qtip(d.qtip_params(b))};this.fullcalendar_options.eventClick=function(b,a,c){return b.source.nolink?!1:""!==b.source.altlink?(b=b.source.altlink.replace("%id%",b.id),window.open(b),!1):b.url?(window.open(b.url),!1):!0};this.fullcalendar_options.dayClick=function(c,a,d){};this.fullcalendar_options.eventAfterAllRender=function(b){if("none"!==f.event_list&&
c("#list-display-"+d.id).is(":checked")){b="#event-table-"+d.id;var a=c("#fullcalendar-"+d.id).fullCalendar("clientEvents");a.sort(function(a,c){return moment(a.start)-moment(c.start)});var n=[];if(!1===f.list_past||!1===f.list_repeat){for(var e=0;e<a.length;e++)if("string"!==typeof a[e].repeat||null===a[e].repeat||""===a[e].repeat||!1!==f.list_repeat)!1===f.list_past&&moment()>moment(a[e].start)||n.push(a[e]);a=n}a=a.slice(0,f.list_max);c(b).empty();if("widget"!==h)for(c(b).css({border:"1px solid silver"}).append(c("<tbody>").append(c("<tr>").addClass("ui-widget-header").append(c("<th>").text("Day").css("padding",
"3px")).append(c("<th>").text("Time").css("padding","3px")).append(c("<th>").text("Event").css("padding","3px")).append(c("<th>").text("Location").css("padding","3px")))),e=0;e<a.length;e++){var n=moment()>moment(a[e].start)?"*":"",u=moment(a[e].start).format("ddd Do"),r=moment(a[e].start).format(d.fullcalendar_options.timeFormat),k="undefined"===typeof a[e].location||null===a[e].location||""===a[e].location?'<span style="visibility:hidden">undefined</span>':"<span>"+a[e].location+"</span>",g=null,
g=a[e].source.nolink?c('<a href="#" class="no-click">').html(n+a[e].title):""!==a[e].source.altlink?c("<a>").attr({href:a[e].source.altlink+a[e].id,target:"_blank"}).html(n+a[e].title):c("<a>").attr({href:a[e].url,target:"_blank"}).html(n+a[e].title);c(b).find("tbody").append(c("<tr>").prop("disabled",n).append(c("<td>").text(u).css("padding","3px")).append(c("<td>").text(r).css("padding","3px")).append(c("<td>").append(g)).append(c("<td>").html(k).css("padding","3px")))}else for(c(b).css({border:"1px solid silver"}).append(c("<tbody>").append(c("<tr>").addClass("ui-widget-header").append(c("<th>").text("Events").css("padding",
"3px")))),e=0;e<a.length;e++)n=moment()>moment(a[e].start)?"*":"",g=null,g=a[e].source.nolink?c('<a href="#" class="no-click">').html(n+a[e].title):""!==a[e].source.altlink?c("<a>").attr({href:a[e].source.altlink+a[e].id,target:"_blank"}).html(n+a[e].title):c("<a>").attr({href:a[e].url,target:"_blank"}).html(n+a[e].title),c(b).find("tbody").append(c("<tr>").qtip(d.qtip_params(a[e])).append(c("<td>").append(g)));c(".no-click").on("click","",{},function(a){a.preventDefault()})}};this.renderCalendar=
function(){"none"===f.event_list?c("#list-display-"+d.id).parent().css("display","none"):c("#list-display-"+d.id).prop("checked","show"===f.event_list);f.legend&&c("#legend-list-"+d.id).css("display","block");this.calendar.fullCalendar(this.fullcalendar_options);for(var b in this.options.feeds)if(""!==this.options.feeds[b].url&&this.options.feeds[b].enabled){var a={googleCalendarApiKey:function(){return"string"===typeof d.options.feeds[b].key&&""!==d.options.feeds[b].key?d.options.feeds[b].key:ibs_util_19()},
nolink:this.options.feeds[b].nolink,nodesc:this.options.feeds[b].nodesc,altlink:this.options.feeds[b].altlink,feedName:this.options.feeds[b].name,textColor:this.options.feeds[b].textColor,backgroundColor:this.options.feeds[b].backgroundColor,url:this.options.feeds[b].url,googleCalendarId:IsEmail(this.options.feeds[b].url)?this.options.feeds[b].url:null};this.calendar.fullCalendar("addEventSource",a);c("#legend-list-"+d.id).append(c("<span>").addClass("ibs-legend-color").css({"background-color":this.options.feeds[b].backgroundColor})).append(c("<span>").addClass("ibs-legend-name").text(this.options.feeds[b].name))}f.ibsEvents&&
this.calendar.fullCalendar("addEventSource",{events:function(a,c,b,f){b=[];for(var k in d.ibs_events){var g=d.ibs_events[k];if(0==g.recurr){var l,m,h,t;l=a.unix();m=c.unix();h=moment(g.start).unix();t=moment(g.end).unix();(h>=l&&t<=m||t>l&&t<m||h>=l&&h<=m||l>=h&&m<=t)&&b.push(g)}else{l=[];if(g.exceptions){l=g.exceptions.split(",");for(var p in l)l[p]=moment(l[p]).startOf("day")}m=(new RRule(RRule.parseString(g.repeat))).between(a.toDate(),c.toDate());for(p in m)m[p]=moment(m[p]).startOf("day");h=
moment(g.end).diff(moment(g.start),"seconds");t=moment(g.start).unix()-moment(g.start).startOf("day").unix();for(p in m){var q;a:{q=p;var v=void 0;for(v in l)if(0===l[v].diff(m[q])){q=!0;break a}q=!1}q||(q=m[p].startOf("day"),q={start:q.add(t,"seconds").format(),end:q.add(h,"seconds").format(),id:g.id,title:g.title,allDay:g.allDay,color:g.color,textColor:g.textColor,description:g.description,url:g.url,repeat:g.repeat,exceptions:g.exceptions},b.push(q))}}for(p in b)b[p].textColor="#ffffff",b[p].editable=
!1}f(b)}});"none"!==f.event_list?("show"===f.event_list&&c("#event-list-"+d.id).show(),c("#list-display-"+d.id).click(function(a){c("#list-display-"+d.id).is(":checked")?(c("#fullcalendar-"+d.id).fullCalendar("rerenderEvents"),c("#event-list-"+d.id).show()):c("#event-list-"+d.id).hide()})):c("#list-display-div-"+d.id).hide()};f.ibsEvents?c.get(d.options.ajaxUrl,{action:"ibs_calendar_get_events",cache:!1,dataType:"json"}).then(function(b){if(""!==b){b=decodeURIComponent(b);d.ibs_events=JSON.parse(b);
for(var a in d.ibs_events)d.ibs_events[a].title=jQuery("<div>").html(d.ibs_events[a].title).text(),d.ibs_events[a].description=jQuery("<div>").html(d.ibs_events[a].description).text(),d.ibs_events[a].editable=!1,d.ibs_events[a].start=moment.unix(parseInt(d.ibs_events[a].start)).format(),d.ibs_events[a].end=moment.unix(parseInt(d.ibs_events[a].end)).format();console.log("IBS Events loaded.")}else d.ibs_events=[];d.renderCalendar()},function(){console.log("Get IBS Events failed.")}):d.renderCalendar()}})(jQuery);
